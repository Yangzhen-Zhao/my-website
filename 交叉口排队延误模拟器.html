
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>éªŒè¯ç‰ˆ - äº¤å‰å£æ’é˜Ÿå»¶è¯¯æ¨¡æ‹Ÿå™¨</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f4f6f8; }
    .panel { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); max-width: 700px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input { width: 80px; margin-left: 10px; }
    canvas { margin-top: 30px; }
    button { margin-top: 20px; padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
    summary { cursor: pointer; margin-top: 20px; font-weight: bold; }
    details[open] summary { font-weight: bold; }
    details { background: #eef2f5; padding: 10px 15px; border-radius: 6px; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="panel">
    <h2>ğŸš¦ äº¤å‰å£äº¤å‰å£æ’é˜Ÿå»¶è¯¯æ¨¡æ‹Ÿå™¨</h2>

    <details open>
      <summary>ğŸ“˜ ä½¿ç”¨è¯´æ˜</summary>
      <ul>
        <li>è¾“å…¥äº¤å‰å£çš„åŸºæœ¬äº¤é€šå‚æ•°ï¼ˆå•ä½ä¸ºç§’ä¸è¾†/ç§’ï¼‰</li>
        <li>ç‚¹å‡»â€œå¼€å§‹æ¨¡æ‹Ÿâ€å±•ç¤ºæ’é˜Ÿè½¦è¾†æ•°é‡å˜åŒ–è¶‹åŠ¿</li>
        <li>Webster å»¶è¯¯è®¡ç®—å…¬å¼ï¼š<br>
          <code>d = [C(1 - g/C)Â²] / [2(1 - x)]</code>ï¼Œå…¶ä¸­ <code>x = Î» / Î¼</code>ï¼ŒÎ»ä¸ºåˆ°è¾¾ç‡ï¼ŒÎ¼ä¸ºé¥±å’Œæµç‡</li>
        <li>æ’é˜Ÿæ›²çº¿åŸºäº D/D/1 æ¨¡æ‹Ÿæ¨¡å‹ï¼š<br>
          åˆ°è¾¾é€Ÿç‡æ’å®šï¼Œæ”¾è¡Œä»…åœ¨ç»¿ç¯æ—¶é—´ï¼Œé˜Ÿåˆ—å‘ˆé”¯é½¿çŠ¶å¢é•¿ä¸æ¸…ç©º</li>
        <li>é€‚ç”¨äºä¿¡æ§äº¤å‰å£é…æ—¶ä¼˜åŒ–åˆ†æã€å»¶è¯¯ä¼°ç®—ä¸æ•™å­¦å¯è§†åŒ–</li>
      </ul>
    </details>

    <label>è½¦æµåˆ°è¾¾ç‡ Î»ï¼ˆè¾†/ç§’ï¼‰<input type="number" id="lambda" value="0.2" step="0.01"></label>
    <label>é€šè¡Œç‡ Î¼ï¼ˆè¾†/ç§’ï¼‰<input type="number" id="mu" value="0.5" step="0.01"></label>
    <label>ä¿¡å·å‘¨æœŸ Cï¼ˆç§’ï¼‰<input type="number" id="cycle" value="60"></label>
    <label>ç»¿ç¯æ—¶é•¿ gï¼ˆç§’ï¼‰<input type="number" id="green" value="30"></label>

    <button onclick="simulate()">å¼€å§‹æ¨¡æ‹Ÿ</button>

    <p id="result"></p>
    <canvas id="queueChart" width="650" height="300"></canvas>
  </div>

<script>
let queueChartInstance = null;

function simulate() {
  const lambda = parseFloat(document.getElementById("lambda").value);
  const mu = parseFloat(document.getElementById("mu").value);
  const C = parseFloat(document.getElementById("cycle").value);
  const g = parseFloat(document.getElementById("green").value);

  const x = lambda / mu;
  const d = (C * Math.pow(1 - g / C, 2)) / (2 * (1 - x));  // Webster å»¶è¯¯è®¡ç®—

  const time = [], queue = [];
  const totalTime = C * 5;
  let q = 0, totalDelay = 0;

  for (let t = 0; t <= totalTime; t++) {
    const inFlow = lambda;
    const outFlow = (t % C < g) ? mu : 0;
    q += inFlow - outFlow;
    if (q < 0) q = 0;
    time.push(t);
    queue.push(q.toFixed(2));
    totalDelay += q;
  }

  const avgDelayEmpirical = totalDelay / totalTime;

  document.getElementById("result").innerHTML = `
    ğŸ“Š <strong>Webster å»¶è¯¯ä¼°ç®—</strong>ï¼š${d.toFixed(2)} ç§’/è¾†<br>
    ğŸ“ˆ <strong>æ¨¡æ‹Ÿå¹³å‡æ’é˜Ÿå»¶è¯¯</strong>ï¼š${avgDelayEmpirical.toFixed(2)} ç§’/è¾†
  `;

  const ctx = document.getElementById("queueChart").getContext("2d");
  if (queueChartInstance) queueChartInstance.destroy();
  queueChartInstance = new Chart(ctx, {
    type: "line",
    data: {
      labels: time,
      datasets: [{
        label: "æ’é˜Ÿè½¦è¾†æ•°",
        data: queue,
        borderColor: "blue",
        backgroundColor: "transparent",
        fill: false,
        tension: 0.3,
        borderWidth: 2,
        pointRadius: 0
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: {
          labels: {
            usePointStyle: false,
            boxWidth: 20,
            boxHeight: 2
          }
        }
      },
      scales: {
        x: { title: { display: true, text: "æ—¶é—´ (ç§’)" }},
        y: { title: { display: true, text: "æ’é˜Ÿè½¦è¾†æ•°" }, beginAtZero: true }
      }
    }
  });
}
</script>
</body>
</html>
